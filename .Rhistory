runSimulation <- function() {
}
#' @makePlot
#'
makePlot <- function() {
}
#' @makeTable
#'
library(lavaan)
library(tidyverse)
library(MASS)
library(glue)
suppressPackageStartupMessages(library(lavaan))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(MASS))
suppressPackageStartupMessages(library(glue))
#' @makeCondition
#
makeCondition <- function(n_sample, cov_size, n_indi, cut_size, n_rep, full = T) {
con_list <-
crossing(n_sample, cov_size, n_indi, cut_size) %>%
mutate(condition_number = row_number())
if(full)
con_list <- crossing(con_list, n_rep)
return(con_list)
}
makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = T)
makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = F)
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = T)
condition_list
#' @makeCondition
#' @example
#' makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = F)
makeCondition <- function(n_sample, cov_size, n_indi, cut_size, n_rep, full = T) {
con_list <-
crossing(n_sample, cov_size, n_indi, cut_size) %>%
mutate(condition_number = row_number())
if(full)
con_list <- crossing(con_list, 1:n_rep)
return(con_list)
}
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = T)
condition_list
#' @makeCondition
#' @example
#' makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = F)
makeCondition <- function(n_sample, cov_size, n_indi, cut_size, n_rep, full = T) {
con_list <-
crossing(n_sample, cov_size, n_indi, cut_size) %>%
mutate(condition_number = row_number())
if(full)
con_list <- crossing(con_list, n_rep = 1:n_rep)
return(con_list)
}
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = c(5), full = T)
condition_list
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
condition_list
condition_list[1,]
matrix(
c(1,1,1,0,0,0,1,1,1,0,0,0),
ncol = 2
)
matrix(
c(1,1,1,0,0,0,0,0,0,1,1,1),
ncol = 2
)
rep(3, 0)
rep(c(1,0), 3)
c(rep(c(1,0), 3), rep(c(0,1), 3))
factor_loadings <- matrix(
c(rep(c(1,0), 3), rep(c(0,1), 3)),
ncol = 2
)
factor_loadings
rep(c(1,0), 3)
factor_loadings <- matrix(
c(rep(c(1,0), 3), rep(c(0,1), 3)),
ncol = 2,
bycol = T
)
factor_loadings <- matrix(
c(rep(c(1,0), 3), rep(c(0,1), 3)),
ncol = 2,
byrow = T
)
factor_loadings
n_indi
N <- 100
cov_size <- 0
n_indi <- 3
factor_loadings <- matrix(
c(rep(c(1,0), n_indi), rep(c(0,1), n_indi)),
ncol = 2,
byrow = T
)
latent_matrix
error_terms <- diag(0.5, n_indi)
error_terms
latent_matrix <- matrix(
c(1, cov_size,
cov_Size, 1)
)
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1)
)
latent_matrix
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1),
ncol = 2
)
latent_matrix
factor_loadings <- matrix(
c(rep(c(1,0), n_indi), rep(c(0,1), n_indi)),
ncol = 2,
byrow = T
)
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1),
ncol = 2
)
error_terms <- diag(0.5, n_indi)
model_impled <- t(factor_loadings) %*% latent_matrix %*% factor_loadings + error_terms
factor_loadings
model_impled <- factor_loadings %*% latent_matrix %*% t(factor_loadings) + error_terms
factor_loadings %*% latent_matrix
factor_loadings %*% latent_matrix %*% t(factor_loadings)
n_indi
error_terms <- diag(0.5, n_indi*2)
error_terms
model_impled <- factor_loadings %*% latent_matrix %*% t(factor_loadings) + error_terms
model_impled
MASS::mvrnorm(N, mean_vector, Sigma = model_impled)
mean_vector <- rep(0, n_indi*2)
MASS::mvrnorm(N, mean_vector, Sigma = model_impled)
#' @genData
#'
genData <- function(N, cov_size, n_indi) {
condition_list[1,]
N <- 100
cov_size <- 0
n_indi <- 3
# factor_loadings <- matrix(
#   c(1,0,
#     1,0,
#     0,1,
#     0,1 ),
#   ncol = 2
# )
factor_loadings <- matrix(
c(rep(c(1,0), n_indi), rep(c(0,1), n_indi)),
ncol = 2,
byrow = T
)
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1),
ncol = 2
)
error_terms <- diag(0.5, n_indi*2)
model_impled <- factor_loadings %*% latent_matrix %*% t(factor_loadings) + error_terms
mean_vector <- rep(0, n_indi*2)
g.data <- MASS::mvrnorm(N, mean_vector, Sigma = model_impled)
g.data <- data.frame(g.data)
}
#' @genData
#' @example
#' genData(N = 100, cov_size = 0, n_indi = 3)
genData <- function(N, cov_size, n_indi) {
# factor_loadings <- matrix(
#   c(1,0,
#     1,0,
#     0,1,
#     0,1 ),
#   ncol = 2
# )
factor_loadings <- matrix(
c(rep(c(1,0), n_indi), rep(c(0,1), n_indi)),
ncol = 2,
byrow = T
)
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1),
ncol = 2
)
error_terms <- diag(0.5, n_indi*2)
model_impled <- factor_loadings %*% latent_matrix %*% t(factor_loadings) + error_terms
mean_vector <- rep(0, n_indi*2)
g.data <- MASS::mvrnorm(N, mean_vector, Sigma = model_impled)
g.data <- data.frame(g.data)
}
genData(N = 100, cov_size = 0, n_indi = 3)
#' @genData
#' @example
#' genData(N = 100, cov_size = 0, n_indi = 3)
genData <- function(N, cov_size, n_indi) {
# factor_loadings <- matrix(
#   c(1,0,
#     1,0,
#     0,1,
#     0,1 ),
#   ncol = 2
# )
factor_loadings <- matrix(
c(rep(c(1,0), n_indi), rep(c(0,1), n_indi)),
ncol = 2,
byrow = T
)
latent_matrix <- matrix(
c(1, cov_size,
cov_size, 1),
ncol = 2
)
error_terms <- diag(0.5, n_indi*2)
model_impled <- factor_loadings %*% latent_matrix %*% t(factor_loadings) + error_terms
mean_vector <- rep(0, n_indi*2)
g.data <- MASS::mvrnorm(N, mean_vector, Sigma = model_impled)
g.data <- data.frame(g.data)
return(g.data)
}
genData(N = 100, cov_size = 0, n_indi = 3)
.data <- genData(N = 100, cov_size = 0, n_indi = 3)
.data[,1]
(r1 <- rank(x1 <- c(3, 1, 4, 15, 92)))
cut.size <- function(x, size) {
cut.prob <- size/length(x)
if (length(x)%%size != 0) warning("Equal sized groups only possible
by dropping some elements from x")
Vec.cut <- cut(x, breaks=c(quantile(x, probs = seq(0, 1, by =
size/length(x)))), include.lowest=TRUE)
}
CUT <- cut.size(rnorm(30), 6)
CUT
cut(rnorm(30), 3, labels = F)
cut_size = 5
cut(x = .data[,1], breaks = cut_size, labels = F)
apply(.data, 2, function(x) cut(x = x, breaks = cut_size, labels = F))
#' @dataCut
#' @example
#'
dataCut <- function(.data, cut_size) {
# cut(x = .data[,1], breaks = cut_size, labels = F)
cut.data <- apply(.data, 2, function(x) cut(x = x, breaks = cut_size, labels = F))
cut.data <- data.frame(cut.data)
return(cut.data)
}
dataCut(.data, cut_size = 5)
.data
cut5.data<- dataCut(.data, cut_size = 5)
cut5.data
cor(cut5.data)
cor(.data)
cov(.data)
cov(cut5.data)
.data
dim(.data)[2]
n_indi <- dim(.data)[2]/2
n_indi
for_f1 <- paste0("X", 1:n_indi)
for_f2 <- paste0("X", (n_indi+1):(2*n_indi))
for_f1
for_f2
paste(for_f1, collapse = " + ")
for_f1 <- paste(for_f1, collapse = " + ")
for_f2 <- paste(for_f2, collapse = " + ")
for_f1
for_f2
.model <- glue('
F1 =~ {for_f1}
F2 =~ {for_f2}
F1 ~~ F2
')
lavaan::sem(model = .model,
data  = .data )
.fit
.fit <- lavaan::sem(model = .model,
data  = .data )
.fit
summary(.fit)
summary(.fit, fitmeasure = T)
summary(.fit, fitmeasures = T)
summary(.fit, fitMeasures = T)
summary(.fit)
.fit <- lavaan::sem(model = .model,
data  = cut5.data )
summary(.fit)
#' @analysis
#'
analysis <- function(.data) {
n_indi <- dim(.data)[2]/2
for_f1 <- paste0("X", 1:n_indi)
for_f2 <- paste0("X", (n_indi+1):(2*n_indi))
for_f1 <- paste(for_f1, collapse = " + ")
for_f2 <- paste(for_f2, collapse = " + ")
.model <- glue('
F1 =~ {for_f1}
F2 =~ {for_f2}
F1 ~~ F2
')
.fit <- lavaan::sem(model = .model,
data  = cut5.data )
# summary(.fit)
return(.fit)
}
analysis(.data)
parameterestimates(.fit)
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2"))
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2")) %>% pull(pvalue)
#' @getPower
#'
getPower <- function() {
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2")) %>% pull(pvalue)
}
#' @getBias
#'
getBias <- function(.fit) {
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2")) %>%
select(est)
}
condition_list
condition_full <- condition_list
dim(condition_full)[2]
dim(condition_full)[1]
tn=1
condition_full$n_sample[tn]
n_smaple         <- condition_full$n_sample[tn]
cov_size         <- condition_full$cov_size[tn]
n_indi           <- condition_full$n_indi[tn]
cut_size         <- condition_full$cut_size[tn]
condition_number <- condition_full$condition_number[tn]
n_rep            <- condition_full$n_rep[tn]
dataCut
original.data <- genData(N = n_sample, cov_size = cov_size, n_indi = n_indi)
cut.data <- dataCut(original.data, cut_size)
n_smaple         <- condition_full$n_sample[tn]
cov_size         <- condition_full$cov_size[tn]
n_indi           <- condition_full$n_indi[tn]
cut_size         <- condition_full$cut_size[tn]
condition_number <- condition_full$condition_number[tn]
n_rep            <- condition_full$n_rep[tn]
original.data <- genData(N = n_sample, cov_size = cov_size, n_indi = n_indi)
n_sample
n_sample         <- condition_full$n_sample[tn]
cov_size         <- condition_full$cov_size[tn]
n_indi           <- condition_full$n_indi[tn]
cut_size         <- condition_full$cut_size[tn]
condition_number <- condition_full$condition_number[tn]
n_rep            <- condition_full$n_rep[tn]
original.data <- genData(N = n_sample, cov_size = cov_size, n_indi = n_indi)
cut.data <- dataCut(original.data, cut_size)
analysis(cut.data)
getBias(.fit)
.fit <- analysis(cut.data)
getBias(.fit)
.fit
#' @getBias
#'
getBias <- function(.fit) {
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2")) %>%
dplyr::select(est)
}
getBias(.fit)
#' @getEst
#'
getEst <- function(.fit) {
parameterestimates(.fit) %>%
filter(str_detect(op, "~~") & str_detect(lhs, "F1") & str_detect(rhs, "F2")) %>%
dplyr::select(est)
}
getEst(.fit)
condition_full[tn, ]
cbind(condition_full[tn, ], est)
est <- getEst(.fit)
cbind(condition_full[tn, ], est)
res <- vector("list", total_n)
total_n <- dim(condition_full)[1]
res <- vector("list", total_n)
res
res <- vector("list", total_n)
for(tn in 1:total_n) {
n_sample         <- condition_full$n_sample[tn]
cov_size         <- condition_full$cov_size[tn]
n_indi           <- condition_full$n_indi[tn]
cut_size         <- condition_full$cut_size[tn]
condition_number <- condition_full$condition_number[tn]
n_rep            <- condition_full$n_rep[tn]
original.data <- genData(N = n_sample, cov_size = cov_size, n_indi = n_indi)
cut.data <- dataCut(original.data, cut_size)
.fit <- analysis(cut.data)
est <- getEst(.fit)
res[[tn]] <- cbind(condition_full[tn, ], est)
}
#' @analysis
#' @example
#' analysis(.data)
analysis <- function(.data) {
n_indi <- dim(.data)[2]/2
for_f1 <- paste0("X", 1:n_indi)
for_f2 <- paste0("X", (n_indi+1):(2*n_indi))
for_f1 <- paste(for_f1, collapse = " + ")
for_f2 <- paste(for_f2, collapse = " + ")
.model <- glue('
F1 =~ {for_f1}
F2 =~ {for_f2}
F1 ~~ F2
')
.fit <- lavaan::sem(model = .model,
data  = .data )
# summary(.fit)
return(.fit)
}
total_n <- dim(condition_full)[1]
res <- vector("list", total_n)
for(tn in 1:total_n) {
n_sample         <- condition_full$n_sample[tn]
cov_size         <- condition_full$cov_size[tn]
n_indi           <- condition_full$n_indi[tn]
cut_size         <- condition_full$cut_size[tn]
condition_number <- condition_full$condition_number[tn]
n_rep            <- condition_full$n_rep[tn]
original.data <- genData(N = n_sample, cov_size = cov_size, n_indi = n_indi)
cut.data <- dataCut(original.data, cut_size)
.fit <- analysis(cut.data)
est <- getEst(.fit)
res[[tn]] <- cbind(condition_full[tn, ], est)
}
res
do.call('rbind',res)
library(trySimulation)
sem
sem()
trySimulation::makeCondition()
ondition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
library(trySimulation)
#' generate table
#' @export
makeTalbe <- function() {
tibble(a = 1:10, b = 1:10)
}
makeTalbe()
library(trySimulation)
makeTalbe()
library(trySimulation)
purrr
library(trySimulation)
makeTalbe()
library(trySimulation)
makeTable()
library(trySimulation)
makeTable()
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
library(trySimulation)
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
library(trySimulation)
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
condition_list
library(trySimulation)
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
sim_result <- runSimulation(condition_list)
library(trySimulation)
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = T)
sim_result <- runSimulation(condition_list)
power_res <- getPower(sim_result)
bias_res <- getBias(sim_result)
makePlot(bias_res, what = "RMSE", font_size = 12)
makePlot(power_res, what = "power", font_size = 12)
makePlot(power_res, what = "typeIerror", font_size = 12)
knitr::opts_chunk$set(echo = TRUE)
library(trySimulation)
sem()
power_res <- getPower(sim_result)
bias_res <- getBias(sim_result)
save(power_res, bias_res, file = ".simulation/results.rdata")
root <- rprojroot::find_rstudio_root_file()
report_path <- file.path(root, ".simulation")
report_path
load(file.path(report_path, "results.rdata"))
ls()
rm(list = ls())
# rm(list = ls())
library(trySimulation)
library(tidyverse)
library(knitr)
library(kableExtra)
root <- rprojroot::find_rstudio_root_file()
report_path <- file.path(root, ".simulation")
load(file.path(report_path, "results.rdata"))
ls()
makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = F)
makePlot(bias_res, what = "RMSE", font_size = 12)
p1 <- makePlot(bias_res, what = "RMSE", font_size = 12)
p1 +
labs(title = "RMSE")
p1 +
labs(title = "RMSE", x = "Cut Size")
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(knitr)
library(kableExtra)
root <- rprojroot::find_rstudio_root_file()
report_path <- file.path(root, ".simulation")
load(file.path(report_path, "results.rdata"))
condition_list <- makeCondition(n_sample = c(100, 500), cov_size = c(0, 0.5), n_indi = c(3, 6), cut_size = c(3,5,7), n_rep = 5, full = F)
